{% extends 'frontend/base.html' %}
{% load static %}
{% block title %}Cart Details | Shorna Mart{% endblock %}

{% block extra_css %}
<style>
    .shipping-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 10px 0;
    }
    .shipping-label {
        flex: 1;
        font-weight: 500;
    }
    .shipping-select {
        flex: 2;
        text-align: center;
    }
    .shipping-select select {
        width: 100%;
        max-width: 180px;
        padding: 6px 8px;
    }
    .shipping-price {
        flex: 1;
        text-align: right;
        font-weight: 600;
    }

    .normal-list {
        list-style-type: none; /* Remove default bullets */
        padding-left: 0;
        margin: 1rem 0;
        font-family: 'Segoe UI', 'Noto Sans Bengali', 'Kalpurush', sans-serif;
    }

    .normal-list li {
        padding: 0.5rem 0;
        border-bottom: 1px dashed #e0e0e0; /* Optional: divider between items */
        display: flex;
        align-items: flex-start;
    }

    .normal-list li:last-child {
        border-bottom: none;
    }

    .normal-list li span {
        font-weight: 600;
        color: #333;
        min-width: 180px; /* Adjust based on your longest label */
        display: inline-block;
        padding-right: 10px;
    }

    /* If you want custom bullet icons */
    .normal-list li::before {
        content: "‚Ä¢";
        color: #007bff; /* Custom bullet color */
        font-weight: bold;
        display: inline-block;
        width: 1em;
        margin-right: 10px;
    }
</style>
{% endblock %}

{% block content %}
    {% include 'frontend/includes/message.html' %}
    <!-- Shopping Cart -->
    <div class="shopping-cart section">
        <div class="container">

            <div class="row">
                <!-- cart item list -->
                <div class="col-8">
                    <div class="cart-list-head">
                        {% if cart and cart.items %}
                            <div class="cart-list-head">
                                <!-- Cart Title -->
                                <div class="cart-list-title">
                                    <div class="row">
                                        <div class="col-lg-1"></div>
                                        <div class="col-lg-4"><p>Product Name</p></div>
                                        <div class="col-lg-2"><p>Quantity</p></div>
                                        <div class="col-lg-2"><p>Subtotal</p></div>
                                        <div class="col-lg-1"><p>Remove</p></div>
                                    </div>
                                </div>

                                <!-- Cart Items -->
                                {% for item in cart.items.all %}
                                <div class="cart-single-list">
                                    <div class="row align-items-center">
                                        <!-- Image -->
                                        <div class="col-lg-1">
                                            <a href="{%  url 'product_detail' item.product.slug %}" target="_blank">
                                                <img src="{{ item.product.feature_image.image.url }}" alt="{{ item.product.name }}">
                                            </a>
                                        </div>

                                        <!-- Name -->
                                        <div class="col-lg-4">
                                            <h5 class="product-name">
                                                <a href="{%  url 'product_detail' item.product.slug %}" target="_blank">
                                                    {{ item.product.name }}
                                                </a>
                                            </h5>
                                        </div>

                                        <!-- Quantity -->
                                        <div class="col-lg-2">
                                            <div class="count-input">
                                                <form action="" method="POST">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="cart_item_id" value="{{ item.pk }}" />
                                                    <button type="submit" class="btn btn-sm mr-2 d-inline-block" name="submit" value="decrement">
                                                        <i class="fa fa-minus text-danger"></i>
                                                    </button>
                                                    {{ item.quantity }}
                                                    <button type="submit" class="btn btn-sm ml-2 d-inline-block" name="submit" value="increment">
                                                        <i class="fa fa-plus text-success"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>

                                        <!-- Subtotal -->
                                        <div class="col-lg-2">
                                            <p>‡ß≥ {{ item.total_price }}</p>
                                        </div>

                                        <!-- Remove -->
                                        <div class="col-lg-1">
                                            <form action="" method="POST">
                                                {% csrf_token %}
                                                <input type="hidden" name="cart_item_id" value="{{ item.pk }}" />
                                                <button class="border-0" type="submit" name="submit" value="remove">
                                                    <i class="fa fa-times  text-danger"></i>
                                                </button>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-center py-5">Your cart is empty üõí</p>
                        {% endif %}
                    </div>
                </div>

                <div class="col-4">
                    <!-- Total Amount -->
                    <div class="total-amount">
                        <div class="row">
                            <div class="col-12">
                                <div class="right pt-0 mt-0">
                                    <h3 class="mb-3 mt-3">Order Summary</h3>
                                    <ul>
                                        <li>Subtotal<span>‡ß≥ {{ cart.subtotal|default_if_none:"0" }}</span></li>
                                        <li class="shipping-row">
                                            <span class="shipping-label">Shipping</span>

                                            <span class="shipping-select">
                                                <form id="district-form" action="" method="post">
                                                    {% csrf_token %}
                                                    <select name="district" id="district" class="d-inline-block">
                                                        <option value="">Select District</option>
                                                        {% for district in districts %}
                                                            <option
                                                                value="{{ district.pk }}"
                                                                {% if cart.district and cart.district.pk == district.pk %}selected{% endif %}
                                                            >
                                                                {{ district }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </form>
                                            </span>

                                            <span class="shipping-price" id="shipping-charge">
                                                ‡ß≥ {{cart.get_shipping_charge|default_if_none:"0" }}
                                            </span>
                                        </li>

                                        <li class="last">1% COD Charge<span> ‡ß≥{{ cart.cod_charge|default_if_none:"0" }}</span></li>
                                        <li class="last">You Pay<span> ‡ß≥{{ cart.grand_total|default_if_none:"0" }}</span></li>
                                    </ul>
                                    <div class="button">
                                        <a href="/checkout" class="btn">Checkout</a>
                                        <a href="/" class="btn btn-alt">Continue shopping</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--/ End Total Amount -->
                </div>

                <div class="col-12">
                    <div style="padding: 30px;border: 1px solid #eee;background-color: #fff;border-radius: 4px;margin-top: 20px;">
                        <h4 class="mb-1">Shipping Options:</h4>
                        <ul class="normal-list">

                            <li> <span>‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞:</span> ‡ßß ‚Äì ‡ß© ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶¶‡¶ø‡¶¨‡¶∏, ‡ß≥‡ß≠‡ß¶ (‡ßß ‡¶ï‡ßá‡¶ú‡¶ø ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§) </li>
                            <li> <span>‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶â‡¶™‡¶ï‡¶£‡ßç‡¶†:</span> ‡ß® ‚Äì ‡ß© ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶¶‡¶ø‡¶¨‡¶∏, ‡ß≥‡ßß‡ß¶‡ß¶ (‡ßß ‡¶ï‡ßá‡¶ú‡¶ø ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§) </li>
                            <li> <span>‡¶¢‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá:</span> ‡ß© ‚Äì ‡ß´ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶¶‡¶ø‡¶¨‡¶∏, ‡ß≥‡ßß‡ß©‡ß¶ (‡ßß ‡¶ï‡ßá‡¶ú‡¶ø ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§) </li>
                            {% comment %} <li> <span>‡¶∏‡ßá‡¶á‡¶Æ ‡¶°‡ßá ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø:</span> ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¢‡¶æ‡¶ï‡¶æ ‡¶∂‡¶π‡¶∞, ‡ß≥‡ßß‡ß®‡ß¶+ </li> {% endcomment %}
                            <li> <span>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ö‡¶® ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø (COD):</span> ‡ßß% COD ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø </li>
                            <li> <span>‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú:</span> ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶ï‡ßá‡¶ú‡¶ø‡¶§‡ßá ‡ß®‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ  ‡¶ì ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶™‡ßç‡¶∞‡¶Ø‡ßã‡¶ú‡ßç‡¶Ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá </li>
                            <li>
                                ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶∏‡¶æ‡¶á‡¶ú‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶Æ‡¶æ‡¶∂‡ßÅ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
                            </li>
                            <li>
                                ‡¶â‡¶ï‡ßç‡¶§ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú‡¶∏‡¶Æ‡ßÇ‡¶π ‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ì ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶§‡¶ø‡¶§
                            </li>
                            <li>
                                ‡¶Ö‡¶®‡¶æ‡¶ï‡¶æ‡¶ô‡ßç‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶ï‡¶æ‡¶∞‡¶£‡¶¨‡¶∂‡¶§ ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
                            </li>
                        </ul>
                        <a href="https://steadfast.com.bd/pricing" target="_blank">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶ú‡¶æ‡¶®‡¶§‡ßá Steadfast ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/ End Shopping Cart -->
{% endblock %}

{% block extra_js %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(function() {
        setTimeout(function() {
            $("#message").hide()
        }, 5000)
    });
</script>
<script>
    $(document).ready(function() {
        $('#district').select2({
            placeholder: 'Select your district',
            allowClear: false
        });

        // calculation ajax
        $("#district").on("change", function () {
            var district_id = $(this).val();
            var url = "{% url 'cart_shipping_ajax' %}";
            console.log('district_id ', district_id);
            console.log('district_id ', district_id);

            $.ajax({
                url: url,
                data: {
                    'district_id': district_id,
                    'cart_id': "{{cart.id}}",
                },
                traditional: true,  // üëà add this line
                success: function (data) {
                    console.log('ajax success', data);
                    location.reload();
                }
            });
        });
    });
</script>
{% endblock %}
